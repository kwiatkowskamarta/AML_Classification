# Tworzenie struktury katalogów
dirs <- c(
"data/raw",        # Tu lądują surowe pliki z TCGA (nie ruszamy ich)
"data/processed",  # Tu zapisujemy wyczyszczone tabele gotowe do ML
"scripts",         # Skrypty R (01_..., 02_...)
"results/plots",   # Wykresy (PDF/PNG)
"results/models",  # Zapisane modele ML (.rds)
"docs"             # Notatki, brudnopisy
)
for(d in dirs){
if(!dir.exists(d)) dir.create(d, recursive = TRUE)
}
print("Struktura katalogów utworzona pomyślnie!")
getwd()
# 1. Instalacja renv (jeśli nie masz)
if (!require("renv")) install.packages("renv")
# 2. Inicjalizacja środowiska w tym projekcie
renv::init()
install.packages('renv')
# 1. Instalacja renv (jeśli nie masz)
if (!require("renv")) install.packages("renv")
# 2. Inicjalizacja środowiska w tym projekcie
renv::init()
install.packages("renv")
# Usuwanie folderu blokady
unlink("C:/Users/kwiat/AppData/Local/R/win-library/4.4/00LOCK", recursive = TRUE)
install.packages("renv")
# 1. Instalacja renv (jeśli nie masz)
if (!require("renv")) install.packages("renv")
# 2. Inicjalizacja środowiska w tym projekcie
renv::init()
content_install <- c(
"# SKRYPT INSTALACYJNY (SETUP)",
"# Uruchom ten skrypt tylko raz na nowym środowisku, aby pobrać biblioteki.",
"# ------------------------------------------------------------------------",
"",
"# 1. Instalacja menedżera środowisk 'renv' (jeśli brak)",
"if (!require('renv', quietly = TRUE)) install.packages('renv')",
"",
"# 2. Aktywacja projektu (tworzy folder bibliotek wewnątrz projektu)",
"renv::init(bare = TRUE) # bare = TRUE oznacza, że startujemy na czysto",
"",
"# 3. Instalacja menedżera pakietów bioinformatycznych BiocManager",
"if (!require('BiocManager', quietly = TRUE)) install.packages('BiocManager')",
"",
"# 4. Lista wymaganych pakietów",
"bio_packages <- c(",
"  'TCGAbiolinks',       # Pobieranie danych z TCGA",
"  'SummarizedExperiment', # Obsługa struktur danych biologicznych",
"  'edgeR',              # Normalizacja danych RNA-seq",
"  'DESeq2',             # Alternatywna normalizacja",
"  'ComplexHeatmap'      # Zaawansowane wizualizacje (mapy ciepła)",
")",
"",
"ml_packages <- c(",
"  'caret',              # Framework do Machine Learning",
"  'randomForest',       # Algorytm Lasów Losowych",
"  'kernlab',            # Algorytm SVM",
"  'Boruta',             # Selekcja cech (Feature Selection)",
"  'pheatmap',           # Proste mapy ciepła",
"  'ggplot2',            # Wykresy",
"  'dplyr',              # Manipulacja danymi",
"  'e1071'               # Metryki i proste modele",
")",
"",
"# 5. Instalacja pakietów",
"message('Instalowanie pakietów z Bioconductor...')",
"BiocManager::install(bio_packages, update = FALSE, ask = FALSE)",
"",
"message('Instalowanie pakietów ML...')",
"install.packages(ml_packages)",
"",
"# 6. Zapisanie stanu bibliotek do pliku renv.lock",
"message('Zapisywanie stanu środowiska do renv.lock...')",
"renv::snapshot()",
"",
"message('GOTOWE! Środowisko jest zainstalowane i zapisane.')"
)
writeLines(content_install, "install_dependencies.R")
source("install_dependencies.R")
renv::status()
renv::install("BiocManager")
renv::snapshot()
# Upewniamy się, że folder scripts istnieje
if(!dir.exists("scripts")) dir.create("scripts")
# --- 01. POBIERANIE ---
skel_01 <- c(
"# SKRYPT 01: Data Download",
"# ------------------------------------------",
"# OPIS: Pobiera surowe dane RNA-seq i kliniczne z bazy TCGA dla projektu LAML.",
"# INPUT: Brak (pobieranie z API)",
"# OUTPUT: Plik data/raw/TCGA_LAML_Raw.RData",
"",
"# 1. Ładowanie bibliotek (TCGAbiolinks)",
"",
"# 2. Definicja zapytania (GDCquery) - dane kliniczne",
"",
"# 3. Pobranie i przygotowanie danych klinicznych",
"",
"# 4. Definicja zapytania (GDCquery) - dane transkryptomiczne (STAR - Counts)",
"",
"# 5. Pobranie i przygotowanie danych RNA-seq",
"",
"# 6. Zapisanie surowych obiektów na dysk (data/raw/)"
)
# --- 02. PREPROCESSING ---
skel_02 <- c(
"# SKRYPT 02: Data Preprocessing & Cleaning",
"# ------------------------------------------",
"# OPIS: Czyści dane, filtruje brakujące próbki i normalizuje ekspresję genów.",
"# INPUT: data/raw/TCGA_LAML_Raw.RData",
"# OUTPUT: data/processed/TCGA_LAML_Cleaned.RData",
"",
"# 1. Wczytanie surowych danych",
"",
"# 2. Przygotowanie macierzy X (geny) i wektora Y (podtypy)",
"#    - Usunięcie pacjentów bez zdefiniowanego podtypu (klasyfikacja FAB)",
"#    - Transpozycja macierzy (Pacjenci jako wiersze)",
"",
"# 3. Filtracja genów",
"#    - Usunięcie genów o zerowej wariancji (stałych)",
"#    - Usunięcie genów o bardzo niskiej ekspresji",
"",
"# 4. Normalizacja danych",
"#    - Zastosowanie transformacji logarytmicznej (log2) lub VST",
"",
"# 5. Zapisanie gotowego datasetu do folderu data/processed/"
)
# --- 03. FEATURE SELECTION ---
skel_03 <- c(
"# SKRYPT 03: Feature Selection (Boruta)",
"# ------------------------------------------",
"# OPIS: Wybiera najważniejsze geny (biomarkery) spośród 20,000 dostępnych.",
"# INPUT: data/processed/TCGA_LAML_Cleaned.RData",
"# OUTPUT: results/selected_features.rds",
"",
"# 1. Wczytanie przetworzonych danych",
"",
"# 2. Wstępna redukcja (opcjonalnie: usunięcie skorelowanych zmiennych)",
"",
"# 3. Uruchomienie algorytmu Boruta (to może potrwać!)",
"#    - Trenowanie na całym zbiorze lub tylko treningowym",
"",
"# 4. Wyświetlenie wyników (wykres ważności cech)",
"",
"# 5. Zapisanie listy wybranych genów (np. top 50-100)"
)
# --- 04. MODELING ---
skel_04 <- c(
"# SKRYPT 04: Machine Learning Models",
"# ------------------------------------------",
"# OPIS: Trenuje i porównuje modele klasyfikacyjne (RF, SVM, kNN).",
"# INPUT: data/processed/TCGA_LAML_Cleaned.RData + results/selected_features.rds",
"# OUTPUT: results/model_performance.csv",
"",
"# 1. Wczytanie danych i wyfiltrowanie tylko wybranych genów",
"",
"# 2. Podział na zbiór treningowy i testowy (np. 75/25)",
"#    - Ustawienie ziarna losowości (set.seed) dla powtarzalności",
"",
"# 3. Konfiguracja walidacji krzyżowej (np. 5-fold CV)",
"",
"# 4. Trening modeli:",
"#    - Model 1: k-NN (Baseline)",
"#    - Model 2: SVM (Linear/Radial)",
"#    - Model 3: Random Forest",
"",
"# 5. Predykcja na zbiorze testowym",
"",
"# 6. Ewaluacja i wizualizacja",
"#    - Macierze pomyłek (Confusion Matrix)",
"#    - Porównanie metryk (Accuracy, Kappa)",
"",
"# 7. Zapisanie wyników"
)
writeLines(skel_01, "scripts/01_data_download.R")
writeLines(skel_02, "scripts/02_preprocessing.R")
writeLines(skel_03, "scripts/03_feature_selection.R")
writeLines(skel_04, "scripts/04_modeling.R")
print("Szkielety plików utworzone pomyślnie!")
git config --global user.name "Marta Kwiatkowska"
source("scripts/01_data_download.R")
# --- 2. DANE RNA-SEQ (Cechy / X) ---
message("2. Pobieranie danych RNA-seq (Gene Expression Quantification).")
message(paste("   Pobrano dane kliniczne dla", nrow(clinical_patient), "pacjentów."))
# SKRYPT 01: Data Download (TCGA-LAML)
# ------------------------------------------------------------------------------
# Cel: Pobranie danych klinicznych i transkryptomicznych (RNA-seq)
# Źródło: GDC (Genomic Data Commons) via TCGAbiolinks
# ------------------------------------------------------------------------------
library(TCGAbiolinks)
renv::restore()
# Używamy specjalnej składni 'bioc::', żeby renv wiedział, że to z Bioconductora
renv::install("bioc::TCGAbiolinks")
library(TCGAbiolinks)
renv::install("SummarizedExperiment")
# --- 1. DANE KLINICZNE (Etykiety / Y) ---
message("1. Pobieranie danych klinicznych.")
# SKRYPT 01: Data Download (TCGA-LAML)
# ------------------------------------------------------------------------------
# Cel: Pobranie danych klinicznych i transkryptomicznych (RNA-seq)
# Źródło: GDC (Genomic Data Commons) via TCGAbiolinks
# ------------------------------------------------------------------------------
library(TCGAbiolinks)
library(SummarizedExperiment)
message(">>> ROZPOCZYNANIE POBIERANIA DANYCH DLA PROJEKTU TCGA-LAML <<<")
# --- 1. DANE KLINICZNE (Etykiety / Y) ---
message("1. Pobieranie danych klinicznych.")
query_clin <- GDCquery(
project = "TCGA-LAML",
data.category = "Clinical",
data.type = "Clinical Supplement",
data.format = "BCR Biotab"
)
GDCdownload(query_clin)
clinical_data <- GDCprepare(query_clin)
# Główną tabela pacjentów
clinical_patient <- clinical_data$clinical_patient_laml
message(paste("   Pobrano dane kliniczne dla", nrow(clinical_patient), "pacjentów."))
# --- 2. DANE RNA-SEQ (Cechy / X) ---
message("2. Pobieranie danych RNA-seq (Gene Expression Quantification).")
query_rna <- GDCquery(
project = "TCGA-LAML",
data.category = "Transcriptome Profiling",
data.type = "Gene Expression Quantification",
workflow.type = "STAR - Counts" # Surowe zliczenia (Raw Counts) - wymagane do DESeq2/edgeR
)
GDCdownload(query_rna)
data_rna <- GDCprepare(query_rna)
getwd()
# 1. Usuń stary, niekompletny folder z danymi tymczasowymi
unlink("GDCdata", recursive = TRUE)
# 2. Uruchom pobieranie ponownie, ale z mniejszymi "paczkami" (bezpieczniej dla łącza)
#    files.per.chunk = 10 oznacza, że pobiera po 10 plików i zapisuje, zamiast wszystkich naraz.
GDCdownload(query_rna, files.per.chunk = 10)
library(TCGAbiolinks)
library(SummarizedExperiment)
# 1. Usuń folder tymczasowy (dla pewności, że startujemy na czysto)
if(dir.exists("GDCdata")) unlink("GDCdata", recursive = TRUE)
message("--- Rozpoczynam ponowne pobieranie (Tryb bezpieczny) ---")
# 2. Definicja zapytania (to samo co wcześniej)
query_rna <- GDCquery(
project = "TCGA-LAML",
data.category = "Transcriptome Profiling",
data.type = "Gene Expression Quantification",
workflow.type = "STAR - Counts"
)
# 3. POBIERANIE - ZMIANA TAKTYKI
# files.per.chunk = 1 -> Pobieramy 1 plik na raz (najbezpieczniej)
# method = "api" -> Wymuszamy metodę API (domyślna, ale warto wskazać)
tryCatch({
GDCdownload(query_rna,
method = "api",
files.per.chunk = 1)
}, error = function(e) {
message("Błąd pobierania: ", e$message)
})
message("--- Pobieranie zakończone. Próba scalania danych... ---")
# 4. Przygotowanie danych
data_rna <- GDCprepare(query_rna)
# 5. Zapis (jeśli się uda)
if(!dir.exists("data/raw")) dir.create("data/raw", recursive = TRUE)
save(data_rna, file = "data/raw/TCGA_LAML_Raw.RData")
message(">>> SUKCES! Plik zapisany w data/raw/ <<<")
# 1. Wczytaj dane (jeśli nie są w pamięci)
load("data/raw/TCGA_LAML_Raw.RData")
# 2. Sprawdź wymiary macierzy RNA (Wiersze x Kolumny)
message("--- WYMIARY MACIERZY RNA ---")
print(dim(SummarizedExperiment::assay(data_rna)))
# 3. Sprawdź nazwy kolumn w danych klinicznych (szukamy 'targetu')
message("--- KOLUMNY KLINICZNE (Pierwsze 20) ---")
print(head(colnames(clinical_patient), 20))
# 4. Sprawdź naszą kolumnę celu (czy są puste wartości?)
# UWAGA: Tu zakładam nazwę, którą widzieliśmy wcześniej. Jeśli rzuci błędem, to znaczy, że nazwa jest inna.
target_col <- "leukemia_french_american_british_morphology_subtype"
if(target_col %in% colnames(clinical_patient)) {
message("--- ROZKŁAD KLAS (PODTYPY) ---")
print(table(clinical_patient[[target_col]], useNA = "ifany"))
} else {
message("⚠️ Nie znaleziono kolumny 'leukemia_french_american_british_morphology_subtype'.")
}
# 5. Sprawdź format ID próbek (żebyśmy mogli połączyć RNA z pacjentami)
message("--- PRZYKŁADOWE ID ---")
message("RNA ID: ", head(colnames(data_rna), 1))
message("Clinical ID: ", head(clinical_patient$bcr_patient_barcode, 1))
# TWORZENIE FOLDERU NA SUROWE PLIKI
if(!dir.exists("GDCdata")) dir.create("GDCdata")
# LISTOWANIE TYLKO FOLDERÓW Z DZIWNYMI NAZWAMI (UUID)
# Szukamy nazw, które zaczynają się od cyfr/liter i mają myślniki (wzorzec UUID)
all_files <- list.files()
uuid_folders <- all_files[grepl("^[0-9a-f]{8}-[0-9a-f]{4}-", all_files)]
message(paste("Znaleziono", length(uuid_folders), "folderów do przeniesienia."))
# PRZENOSZENIE
if(length(uuid_folders) > 0) {
sapply(uuid_folders, function(f) {
file.rename(from = f, to = file.path("GDCdata", f))
})
message("SUKCES! Foldery zostały przeniesione do katalogu 'GDCdata'.")
} else {
message("Jest czysto - nie ma folderów do przeniesienia.")
}
# SKRYPT 02: Preprocessing (Czyszczenie i Normalizacja)
# ------------------------------------------------------------------------------
# Cel: Przygotowanie tabeli "ML-ready" z surowych danych.
# Input: data/raw/TCGA_LAML_Raw.RData
# Output: data/processed/TCGA_LAML_Cleaned.RData
# ------------------------------------------------------------------------------
library(SummarizedExperiment)
library(dplyr)
library(edgeR) # Do normalizacji (CPM)
# 1. Wczytaj dane (jeśli nie są w pamięci)
load("data/raw/TCGA_LAML_Raw.RData")
# 2. Sprawdź wymiary macierzy RNA (Wiersze x Kolumny)
message("--- WYMIARY MACIERZY RNA ---")
print(dim(SummarizedExperiment::assay(data_rna)))
# 3. Sprawdź nazwy kolumn w danych klinicznych (szukamy 'targetu')
message("--- KOLUMNY KLINICZNE (Pierwsze 20) ---")
print(head(colnames(clinical_patient), 20))
# 4. Sprawdź naszą kolumnę celu (czy są puste wartości?)
# UWAGA: Tu zakładam nazwę, którą widzieliśmy wcześniej. Jeśli rzuci błędem, to znaczy, że nazwa jest inna.
target_col <- "leukemia_french_american_british_morphology_subtype"
if(target_col %in% colnames(clinical_patient)) {
message("--- ROZKŁAD KLAS (PODTYPY) ---")
print(table(clinical_patient[[target_col]], useNA = "ifany"))
} else {
message("⚠️ Nie znaleziono kolumny 'leukemia_french_american_british_morphology_subtype'.")
}
# 5. Sprawdź format ID próbek (żebyśmy mogli połączyć RNA z pacjentami)
message("--- PRZYKŁADOWE ID ---")
message("RNA ID: ", head(colnames(data_rna), 1))
message("Clinical ID: ", head(clinical_patient$bcr_patient_barcode, 1))
load("data/raw/TCGA_LAML_Raw.RData")
# 1. Pobierz wszystkie nazwy kolumn
all_cols <- colnames(clinical_patient)
# 2. Szukaj słów kluczowych (niezależnie od wielkości liter)
keywords <- c("fab", "morphology", "subtype", "class")
matches <- grep(paste(keywords, collapse="|"), all_cols, value = TRUE, ignore.case = TRUE)
message("--- ZNALEZIONE KOLUMNY KANDYDUJĄCE ---")
print(matches)
# 3. Sprawdźmy też zawartość pierwszej znalezionej kolumny (żeby zobaczyć czy to to)
if(length(matches) > 0) {
message("\n--- PRZYKŁADOWE WARTOŚCI W PIERWSZEJ ZNALEZIONEJ KOLUMNIE ---")
print(table(clinical_patient[[matches[1]]]))
}
# --- AUDYT PLIKU DANYCH ---
file_path <- "data/raw/TCGA_LAML_Raw.RData"
if(file.exists(file_path)) {
# 1. Sprawdź rozmiar (zbyt mały plik = błąd zapisu)
info <- file.info(file_path)
size_mb <- round(info$size / 1024 / 1024, 2)
message("✅ Plik istnieje. Rozmiar: ", size_mb, " MB")
if(size_mb < 5) warning("⚠️ UWAGA: Plik jest podejrzanie mały! Sprawdź to.")
# 2. Sprawdź zawartość (czy da się wczytać?)
tryCatch({
load(file_path)
message("✅ Plik wczytuje się poprawnie.")
# 3. Sprawdź kompletność obiektów
if(exists("data_rna") && exists("clinical_patient")) {
n_samples <- ncol(SummarizedExperiment::assay(data_rna))
n_genes <- nrow(SummarizedExperiment::assay(data_rna))
message("✅ Struktura danych poprawna.")
message("   -> Liczba próbek (RNA): ", n_samples)
message("   -> Liczba genów: ", n_genes)
if(n_samples > 100) message("✅ Wygląda na kompletny dataset AML.")
else warning("⚠️ Mało próbek (<100). Czy pobieranie zakończyło się w pełni?")
} else {
stop("❌ Brakuje obiektów 'data_rna' lub 'clinical_patient' w pliku!")
}
}, error = function(e) {
message("❌ BŁĄD: Nie można wczytać pliku! Jest uszkodzony.")
message("Treść błędu: ", e$message)
})
} else {
message("❌ BŁĄD: Plik ", file_path, " nie istnieje!")
}
load("data/raw/TCGA_LAML_Raw.RData")
View(data_rna)
View(data_rna)
View(clinical_data)
View(clinical_data)
View(clinical_patient)
View(clinical_patient)
View(data_rna)
View(data_rna)
data_rna
source("scripts/02_preprocessing.R")
renv::install("edgeR")
source("scripts/02_preprocessing.R")
source("scripts/02_preprocessing.R")
# Wczytanie danych
load("data/raw/TCGA_LAML_Raw.RData")
# Szukamy kolumn pasujących do wzorca
candidates <- grep("morphology|french", colnames(clinical_patient), value = TRUE, ignore.case = TRUE)
message("--- DOKŁADNE NAZWY KOLUMN (Kopiuj stąd!) ---")
print(candidates)
# Sprawdźmy też, co w nich siedzi (pierwsze 5 wartości)
if(length(candidates) > 0) {
message("\n--- ZAWARTOŚĆ PIERWSZEJ ZNALEZIONEJ KOLUMNY ---")
print(table(clinical_patient[[candidates[1]]]))
}
load("data/raw/TCGA_LAML_Raw.RData")
message("--- SZUKANIE KOLUMNY Z DIAGNOZAMI (M1, M2, M3...) ---")
# Sprawdzamy każdą kolumnę: czy zawiera wartość "M3" (charakterystyczny podtyp)?
# To zwróci nazwę kolumny, która ma w środku "M3"
found_col <- colnames(clinical_patient)[apply(clinical_patient, 2, function(x) any(grepl("M3", x, fixed=TRUE)))]
if(length(found_col) > 0) {
message("✅ ZNALEZIONO KOLUMNĘ: ", found_col)
message("--- Przykładowe wartości: ---")
print(table(clinical_patient[[found_col[1]]]))
} else {
message("❌ Nie znaleziono żadnej kolumny zawierającej 'M3'.")
message("Dostępne kolumny to:")
print(colnames(clinical_patient))
}
source("scripts/02_preprocessing.R")
source("scripts/03_feature_selection.R")
renv::install("Boruta")
source("scripts/03_feature_selection.R")
renv::install("caret")
source("scripts/03_feature_selection.R")
source("scripts/04_modeling.R")
renv::install("randomForest")
source("scripts/04_modeling.R")
source("scripts/04_modeling.R")
source("scripts/04_modeling.R")
source("scripts/04_modeling.R")
source("scripts/04_modeling.R")
source("scripts/04_modeling.R")
source("scripts/04_modeling.R")
source("scripts/04_modeling.R")
source("scripts/04_modeling_test.R")
getwd()
source("scripts/04_modeling_test.R")
